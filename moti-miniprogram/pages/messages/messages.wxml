<view class="container {{darkMode ? 'dark' : ''}}">
  <!-- 顶部导航 -->
  <view class="header" style="padding-top: {{statusBarHeight}}px;">
    <view class="header-content">
      <view class="header-left">
        <view class="back-btn" bindtap="goBack">
          <image src="/images/icons/arrow-left.svg" class="back-icon" mode="aspectFit" />
        </view>
        <text class="header-title">我的消息</text>
      </view>
      <view class="header-right">
        <view class="capsule-btn">
          <image src="/images/icons/more.svg" class="capsule-icon" mode="aspectFit" bindtap="showMore" />
          <view class="capsule-divider"></view>
          <image src="/images/icons/menu-dots.svg" class="capsule-icon" mode="aspectFit" />
        </view>
      </view>
    </view>
  </view>

  <!-- Tab 栏 -->
  <view class="tab-bar" style="top: {{navBarHeight}}px;">
    <view class="tabs-left">
      <view class="tab-item {{currentTab === 'comments' ? 'active' : ''}}" bindtap="switchTab" data-tab="comments">
        <text>点赞评论</text>
        <view class="badge" wx:if="{{commentCount > 0}}">{{commentCount > 99 ? '99+' : commentCount}}</view>
      </view>
      <view class="tab-item {{currentTab === 'system' ? 'active' : ''}}" bindtap="switchTab" data-tab="system">
        <text>系统消息</text>
        <view class="badge" wx:if="{{systemCount > 0}}">{{systemCount > 99 ? '99+' : systemCount}}</view>
      </view>
    </view>
    <view class="collapse-btn" bindtap="toggleCollapse">
      <text>{{isCollapsed ? '展开' : '收起'}}</text>
      <image src="/images/icons/{{isCollapsed ? 'arrow-down' : 'arrow-up'}}.svg" class="collapse-icon" mode="aspectFit" />
    </view>
  </view>

  <!-- 主内容区 -->
  <scroll-view
    class="content-scroll"
    scroll-y
    enhanced
    show-scrollbar="{{false}}"
    style="padding-top: {{navBarHeight + 48}}px;"
    wx:if="{{!isCollapsed}}"
  >
    <!-- 点赞评论列表 -->
    <view class="message-list" wx:if="{{currentTab === 'comments'}}">
      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{comments.length === 0}}">
        <image src="/images/icons/empty.svg" class="empty-icon" mode="aspectFit" />
        <text class="empty-text">暂无消息</text>
      </view>

      <!-- 评论列表 -->
      <view
        class="message-item swipe-item {{item.swiped ? 'swiped' : ''}}"
        wx:for="{{comments}}"
        wx:key="id"
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd"
        data-index="{{index}}"
        data-type="comments"
      >
        <view class="message-content" bindtap="goToDetail" data-id="{{item.id}}" data-type="comment">
          <image src="{{item.avatar}}" class="message-avatar" mode="aspectFill" />
          <view class="message-main">
            <view class="message-header">
              <text class="message-name">{{item.author}}</text>
              <text class="message-time">{{item.time}}</text>
            </view>
            <text class="message-text">{{item.content}}</text>
          </view>
        </view>
        <view class="delete-action" catchtap="deleteMessage" data-index="{{index}}" data-type="comments">
          <text>删除</text>
        </view>
      </view>
    </view>

    <!-- 系统消息列表 -->
    <view class="message-list system-list" wx:if="{{currentTab === 'system'}}">
      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{systemMessages.length === 0}}">
        <image src="/images/icons/empty.svg" class="empty-icon" mode="aspectFit" />
        <text class="empty-text">暂无系统消息</text>
      </view>

      <!-- 系统消息列表 -->
      <view
        class="system-item swipe-item {{item.swiped ? 'swiped' : ''}}"
        wx:for="{{systemMessages}}"
        wx:key="id"
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd"
        data-index="{{index}}"
        data-type="system"
      >
        <view class="system-content" bindtap="goToDetail" data-id="{{item.id}}" data-type="system">
          <text class="system-title">{{item.title}}</text>
          <text class="system-date">{{item.date}}</text>
        </view>
        <view class="delete-action" catchtap="deleteMessage" data-index="{{index}}" data-type="system">
          <text>删除</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 收起状态 -->
  <view class="collapsed-hint" wx:if="{{isCollapsed}}" style="padding-top: {{navBarHeight + 80}}px;">
    <text>消息已收起，点击"展开"查看</text>
  </view>
</view>
