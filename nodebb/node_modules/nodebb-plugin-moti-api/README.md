# NodeBB Plugin - è«æä¹‹åœ°APIæ‰©å±•

ä¸ºè«æä¹‹åœ°å°ç¨‹åºæä¾›APIæ‰©å±•åŠŸèƒ½

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°

- âœ… ç”¨æˆ·ä¿¡æ¯API
- âœ… å¸–å­åˆ—è¡¨APIï¼ˆæ”¯æŒæ’åºï¼‰
- âœ… å¸–å­è¯¦æƒ…API
- âœ… ç‚¹èµåŠŸèƒ½API
- âœ… æ”¶è—åŠŸèƒ½API
- âœ… é˜…è¯»æƒé™æ§åˆ¶ï¼ˆæœªä»˜è´¹ç”¨æˆ·æ¯æ—¥é™è¯»1ç¯‡ï¼‰
- âœ… VIPä¼šå‘˜æƒé™åˆ¤æ–­

### ğŸ”¨ å¼€å‘ä¸­

- ğŸ”¨ å¾®ä¿¡ç™»å½•é›†æˆ
- ğŸ”¨ æ‰‹æœºå·ç»‘å®š
- ğŸ”¨ æ”¯ä»˜ç³»ç»Ÿé›†æˆ
- ğŸ”¨ ç§¯åˆ†ç³»ç»Ÿ
- ğŸ”¨ ç¬”è®°åŠŸèƒ½

## API æ–‡æ¡£

### æµ‹è¯•æ¥å£

```http
GET /api/moti/test
```

å“åº”ï¼š
```json
{
  "success": true,
  "message": "è«æä¹‹åœ°APIæ’ä»¶è¿è¡Œæ­£å¸¸",
  "version": "1.0.0",
  "timestamp": 1234567890
}
```

### ç”¨æˆ·ç›¸å…³

#### è·å–ç”¨æˆ·ä¿¡æ¯

```http
GET /api/moti/user/profile
Authorization: Bearer <token>
```

å“åº”ï¼š
```json
{
  "success": true,
  "data": {
    "uid": 1,
    "username": "admin",
    "email": "admin@localhost",
    "picture": "https://...",
    "isVip": true,
    "vipExpire": 1735689600000,
    "points": 100,
    "dailyReads": 0,
    "reputation": 0,
    "postcount": 5,
    "joindate": 1698825600000
  }
}
```

#### å¾®ä¿¡ç™»å½•

```http
POST /api/moti/auth/wechat
Content-Type: application/json

{
  "code": "wx_login_code"
}
```

#### ç»‘å®šæ‰‹æœºå·

```http
POST /api/moti/auth/phone
Authorization: Bearer <token>
Content-Type: application/json

{
  "phone": "13800138000",
  "code": "123456"
}
```

### å†…å®¹ç›¸å…³

#### è·å–å¸–å­åˆ—è¡¨

```http
GET /api/moti/posts?page=1&sort=recent
```

å‚æ•°ï¼š
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `sort`: æ’åºæ–¹å¼
  - `recent`: æœ€æ–°
  - `popular`: æœ€çƒ­
  - `mostbookmarked`: æœ€å¤šæ”¶è—

å“åº”ï¼š
```json
{
  "success": true,
  "data": {
    "topics": [...],
    "page": 1,
    "pageCount": 5
  }
}
```

#### è·å–å¸–å­è¯¦æƒ…

```http
GET /api/moti/post/:pid
```

**æƒé™æ§åˆ¶**ï¼š
- æœªç™»å½•ç”¨æˆ·ï¼šç¦æ­¢è®¿é—®
- æ™®é€šç”¨æˆ·ï¼šæ¯æ—¥é™è¯»1ç¯‡
- VIPç”¨æˆ·ï¼šæ— é™åˆ¶

å“åº”ï¼š
```json
{
  "success": true,
  "data": {
    "pid": 1,
    "tid": 1,
    "content": "å¸–å­å†…å®¹",
    "timestamp": 1234567890,
    ...
  }
}
```

å¤±è´¥å“åº”ï¼ˆè¶…è¿‡é™åˆ¶ï¼‰ï¼š
```json
{
  "error": "ä»Šæ—¥å…è´¹é˜…è¯»æ¬¡æ•°å·²ç”¨å®Œ",
  "code": "DAILY_LIMIT_EXCEEDED",
  "needVip": true
}
```

### äº’åŠ¨ç›¸å…³

#### ç‚¹èµ

```http
POST /api/moti/post/:pid/upvote
Authorization: Bearer <token>
```

#### æ”¶è—

```http
POST /api/moti/post/:pid/bookmark
Authorization: Bearer <token>
```

## æ•°æ®åº“æ‰©å±•

æ’ä»¶æ‰©å±•äº†ä»¥ä¸‹Rediså­—æ®µï¼š

```javascript
user:{uid} hash
  - vip_expire_time      // VIPåˆ°æœŸæ—¶é—´æˆ³
  - points               // ç§¯åˆ†
  - daily_read_count     // ä»Šæ—¥é˜…è¯»æ•°
  - last_read_date       // æœ€åé˜…è¯»æ—¥æœŸ
  - phone                // æ‰‹æœºå·
  - wechat_openid        // å¾®ä¿¡openid
```

## å®‰è£…

æ’ä»¶å·²ç»åŒ…å«åœ¨é¡¹ç›®ä¸­ï¼Œå¯ç”¨æ–¹å¼ï¼š

1. è¿›å…¥ NodeBB ç®¡ç†åå°
2. å¯¼èˆªåˆ° "æ‰©å±• > æ’ä»¶"
3. æ‰¾åˆ° "è«æä¹‹åœ°APIæ‰©å±•"
4. ç‚¹å‡»"æ¿€æ´»"
5. é‡å»ºå¹¶é‡å¯ NodeBB

æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
./nodebb activate nodebb-plugin-moti-api
./nodebb build
./nodebb restart
```

## å¼€å‘

ä¿®æ”¹æ’ä»¶åéœ€è¦é‡å¯NodeBBï¼š

```bash
cd nodebb
./nodebb restart
```

## License

MIT
