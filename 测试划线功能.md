# 如何测试 NodeBB 划线笔记功能

## ✅ 已完成的工作

1. **创建了前端 JavaScript 文件** (/nodebb-plugin-moti-api/static/lib/highlight.js)
2. **修改了 plugin.json** 注册静态资源和 hooks
3. **添加了脚本加载 hook** (filter:scripts.get)
4. **重新构建并重启了 NodeBB**

## 📝 测试步骤

### 1. 打开 NodeBB 论坛
访问: http://localhost:4567

### 2. 创建或进入一个帖子
   - 如果还没有帖子，先创建一个测试帖子
   - 帖子内容随意，但要有足够的文字用于划线

### 3. 查找划线工具栏
在帖子页面，你应该会在**右上角**看到一个固定的工具栏，包含：
   - 📝 标题"划线笔记"
   - ✨ "高亮选中文字"按钮
   - 颜色选择器（4种颜色）
   - 📋 "查看笔记"按钮
   - 🗑️ "清除高亮"按钮

### 4. 使用划线功能
   1. 用鼠标选中帖子中的一段文字
   2. 点击"✨ 高亮选中文字"按钮
   3. 会弹出一个对话框，显示你选中的文字
   4. 输入你的笔记（可选）
   5. 点击"保存笔记"
   6. 文字会被高亮显示

### 5. 查看笔记
   - 点击"📋 查看笔记"按钮
   - 可以看到所有保存的笔记列表

## 🔍 如果功能没有出现

### 方法1：检查浏览器控制台
1. 按 F12 打开浏览器开发者工具
2. 切换到"Console"标签
3. 查看是否有错误信息
4. 刷新页面，看看是否有"[Moti] 划线笔记功能已加载"的日志

### 方法2：检查脚本是否加载
在浏览器控制台输入：
```javascript
window.MotiHighlight
```
如果显示一个对象，说明脚本已加载；如果显示 `undefined`，说明脚本未加载。

### 方法3：手动加载脚本
如果自动加载失败，可以在浏览器控制台手动加载：
```javascript
var script = document.createElement('script');
script.src = '/plugins/nodebb-plugin-moti-api/static/lib/highlight.js';
document.head.appendChild(script);
```

然后刷新页面，重新初始化：
```javascript
MotiHighlight.init();
```

## 🐛 常见问题

### 问题1：工具栏不显示
**原因**：可能不在帖子页面
**解决**：确保你在一个帖子详情页面，而不是帖子列表页

### 问题2：点击高亮没反应
**原因**：没有选中文字
**解决**：先用鼠标拖动选中一段文字，然后再点击按钮

### 问题3：脚本加载失败
**原因**：NodeBB 可能没有正确注册脚本
**解决**：
1. 检查 /Users/changpengcheng/MT/nodebb/logs/output.log
2. 查看是否有错误信息
3. 尝试重新构建：`./nodebb build && ./nodebb restart`

## 📊 当前状态

- ✅ NodeBB 运行中：http://localhost:4567
- ✅ 插件已激活：nodebb-plugin-moti-api
- ✅ API 运行正常：http://localhost:4567/api/moti/test
- ✅ 前端资源已构建
- ⏳ 等待测试确认功能是否正常

## 🎯 下一步

如果划线功能正常工作，接下来可以：
1. 优化 UI 样式
2. 添加更多颜色选项
3. 实现笔记同步到服务器（目前是本地存储）
4. 添加笔记搜索功能
5. 支持笔记分享

如果划线功能没有出现，请告诉我浏览器控制台的错误信息，我会继续调试。
